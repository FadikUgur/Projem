@{
    ViewBag.Title = "Ilan_Ver";
    Layout = "~/Views/Admin/Index.cshtml";
}
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<link href="~/Content/css/fileinput.css" media="all" rel="stylesheet" type="text/css" />
<link href="~/Content/themes/explorer/theme.css" media="all" rel="stylesheet" type="text/css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="~/Content/fileinput/sortable.js" type="text/javascript"></script>
<script src="~/Content/fileinput/fileinput.js" type="text/javascript"></script>
<script src="~/Content/fileinput/fr.js" type="text/javascript"></script>
<script src="~/Content/fileinput/es.js" type="text/javascript"></script>
<script src="~/Content/themes/explorer/theme.js" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" type="text/javascript"></script>
<script type="text/javascript">

</script>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">İlan İşlemleri</h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <div class="notifyjs-corner" style="top: 100px; right: 0px;">
        <div class="notifyjs-wrapper notifyjs-hidable">
            <div class="notifyjs-arrow" style=""></div>
            <div class="notifyjs-container">
            </div>
        </div>
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    Ürün Bilgileri
                                </div>
                                <div class="panel-body panel-default">
                                    <label>Ürün Adı:</label>
                                    <input class="form-control" id="urunadi" name="urunadi">
                                    <label>Açıklama:</label>
                                    <textarea class="form-control" id="aciklama" name="aciklama" rows="3"></textarea>
                                    <label>İlan Tarihi:</label>
                                    <input class="form-control" id="tarih" type="date" name="partydate">
                                    <div class="form-group">
                                        <label>Üst Kategori Seçiniz</label>
                                        <select class="form-control" id="dtlParent" name="dtlParent" onchange="Ozellik_List();">
                                            @using (var context = new MvcProjem.Models.VeriTabanı())
                                            {
                                                var query = from a in context.kategoriler select a;
                                                foreach (var item in query)
                                                {
                                                <option value="@item.id">@item.kategoriadi</option>
                                                }
                                            }

                                        </select>
                                    </div>
                                    <label>Ürün Değeri:</label>
                                    <input class="form-control" id="degeri" name="degeri">
                                </div>
                            </div>
                        </div>
                        <!-- /.col-lg-4 -->
                        <div class="col-lg-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    Ürün Özellikleri
                                </div>
                                <div class="panel-body panel-default">

                                    <select class="form-control" id="ozelliklist" name="ozelliklist">
                                        <option></option>
                                    </select>
                                    <div class="form-group col-lg-12">
                                    </div>
                                    <div class="form-group col-lg-8">
                                        <input class="form-control" id="ozellik" name="ozellik">
                                    </div>
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary fa fa-plus" onclick="List();"></button>
                                    </div>
                                    <div class="from-group col-lg-12">
                                        <label>Özellik Listesi</label>
                                    </div>
                                    <div class="form-group">
                                        <select multiple class="form-control" id="oz_add">
                                        </select>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- /.col-lg-4 -->
                    @if (ViewBag.Id == null)
                    {
                        <div class="row" id="divresim" style="display: none">

                            <div class="col-lg-12">
                                <div class="panel panel-default">
                                    <div class="panel-heading" style="font-size: medium">
                                        Ürün Resimleri
                                    </div>
                                    <div class="panel-body panel-default">

                                        <div class="form-group">
                                            <div class="container kv-main">
                                                <form enctype="multipart/form-data">
                                                    <div class="form-group">
                                                        <input id="file-1" type="file" multiple class="file" data-overwrite-initial="false" data-min-file-count="2">
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- /.col-lg-12 -->
                        </div>
                    }else
                    {
                        <div class="row" id="divresim" >

                            <div class="col-lg-12">
                                <div class="panel panel-default">
                                    <div class="panel-heading" style="font-size: medium">
                                        Ürün Resimleri
                                    </div>
                                    <div class="panel-body panel-default">

                                        <div class="form-group">
                                            <div class="container kv-main">
                                                <form enctype="multipart/form-data">
                                                    <div class="form-group">
                                                        <input id="file-1" type="file" multiple class="file" data-overwrite-initial="false" >
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- /.col-lg-12 -->
                        </div>
                    }


                    <div class="panel-footer">
                        <button type="button" class="btn btn-default" onclick="U_Add();">İlan Ver</button>
                    </div>
                </div>
            </div>

        </div>
        <!-- /.panel -->
    </div>
    <!-- /.col-lg-12 -->
</div>

<script>
    var urunid;
   // $(document).ready(function () {
        
        var id =parseInt(@ViewBag.Id);
        $("#file-1").fileinput({
            uploadUrl: 'http://localhost:4684/Admin/FileUpload?id=' +id, // you must set a valid URL here else you will get an error

            overwriteInitial: false,
            maxFileSize: 1000,
            maxFilesNum: 10,
            //allowedFileTypes: ['image', 'video', 'flash'],
            slugCallback: function (filename) {
                return filename.replace('(', '_').replace(']', '_');
            }
        });
        
   // });

    function Ozellik_List() {
        var Id = $("#dtlParent").val();
        var html = "";
        try {
            var CatID = {
                CatID: Id
            };
            $.getJSON("/Admin/Ozellik_List", CatID, function (data) {
                $suc = false;
                //alert(data.objectList.length);
                for (var i = 0 ; i < data.objectList.length; i++) {
                    html += "<option value=" + data.objectList[i].id + ">" + data.objectList[i].name + "</option>";
                }
                //alert(html);
                $("#ozelliklist").html(html);
            });
        }
        catch (ex) {
            alert(ex);
        }
    }
    function List() {
        //$resimId = $("#file-drop-zone").val();
        var html = $("#oz_add").html();
        var count = document.getElementById("ozelliklist").length;
        var Id = $("#ozelliklist").val();
        var ozellik = $("#ozellik").val();
        var options = $("#oz_add option[value=" + Id + "]");
        //if (options.length >= 0) {
        //    alert("Bu kategoriyi eklediniz !! ");
        //    //$.notify("Bu kategoriyi eklediniz !! ", "warn");
        //    return;
        //}
        html += "<option value=" + Id + ">" + ozellik + "</option>";
        $("#oz_add").html(html);

    }
    function U_Add() {
        try {

            var vals = "";
            var oz = "";
            var sel = document.querySelector("#oz_add");
            for (var i = 0, n = sel.options.length; i < n; i++) {
                if (sel.options[i].value) {
                    vals += sel.options[i].value + ",";
                }
                /*if (sel.options[i].text()) {
                    oz += sel.options[i].text() + ",";
                }*/
                oz += $("#oz_add option[value='" + sel.options[i].value + "']").text() + ",";

            }

            var data = {
                id: 0,
                urunadi: $("#urunadi").val(),
                aciklama: $("#aciklama").val(),
                tarih: $("#tarih").val(),
                kategoriid: $("#dtlParent option:selected").val(),
                degeri: $("#degeri").val(),
                ozellikid: vals,
                value: oz
            };
        }
        catch (ex) {
            alert(ex);
        }
        $.getJSON("/Admin/Urun_Add", data, function (data) {

            $suc = false;
            $.each(data, function (key, val) {
                if (key == "success") {
                    $suc = val;
                }
                else if (key == "message" && $suc == false) {
                    alert(val);
                }
                else if (key == "message" && $suc == true) {
                    alert("Ürün Kayıt Edildi...");
                    $u_id = data.objectList[0].id;
                    window.location.assign("http://localhost:4684/Admin/Ilan_Ver?id=" + $u_id);
                }
            });
        });
    }
</script>
