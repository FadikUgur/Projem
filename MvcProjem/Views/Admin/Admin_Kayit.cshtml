@{
    ViewBag.Title = "Admin_Kayit";
    Layout = "~/Views/Admin/Index.cshtml";
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
@if (MvcProjem.Controllers.Yetkiler.editAdmin)
{
    <div class="row">
        <div class="col-lg-4">
        </div>
        <!-- /.col-lg-4 -->
        <div class="col-lg-4">
            <div class="panel panel-primary">
                <div class="panel-heading">
                </div>
                <div class="panel-body">
                    <label>Adınız:</label>
                    <input class="form-control" id="txtadi" name="txtadi">
                    <label>Soyadınız:</label>
                    <input class="form-control" id="txtsoyadi" name="txtsoyadi">
                    <label>Mail Adresiniz:</label>
                    <input class="form-control" id="txtmail" name="txtmail">
                    <label>Şifreniz:</label>
                    <input type="password" class="form-control" id="txtsifre" name="txtsifre">
                    <label>Adresiniz:</label>
                    <input class="form-control" id="txtadres" name="txtadres">
                    <label>Telefon Numaranız:</label>
                    <input class="form-control" id="txttel" name="txttel">
                    <label>T.C. Kimlik Numaranız:</label>
                    <input class="form-control" id="txtTc" name="txtTc">
                </div>
                <div class="panel-footer">
                    <button type="button" onclick="Admin_Add()" class="btn btn-primary">Kaydet</button>
                </div>
            </div>
        </div>
        <!-- /.col-lg-4 -->
        <div class="col-lg-4">
        </div>
        <!-- /.col-lg-4 -->
    </div>
}
<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                Admin Listesi
                       
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Adı</th>
                                <th>Soyadı</th>
                                <th>Mail Adresi</th>
                                <th>Yetki Ver</th>
                            </tr>
                        </thead>
                        <tbody>

                            @using (var context = new MvcProjem.Models.VeriTabanı())
                            {

                                var query = from a in context.adminler select a;
                                foreach (var item in query)
                                {
                                <tr>
                                    <td>@item.id</td>
                                    <td>@item.adi</td>
                                    <td>@item.soyadi</td>
                                    <td>@item.mail</td>
                                    <td>
                                        <button type="button" style="display: block" id="btnyetki" class="btn btn-primary" data-toggle="modal" data-target="#@item.id">Yetki Ver</button>
                                        <div class="modal fade" id="@item.id" role="dialog">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                        <h4 class="modal-title">Yetkiler</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        @using (var context2 = new MvcProjem.Models.VeriTabanı())
                                                        {
                                                            var query2 = from a in context2.yetkiler where a.adminId == item.id select a;
                                                            var item2 = query2.FirstOrDefault();
                                                            
                                                            <label class="checkbox-inline">
                                                                <input type="checkbox" id="cbMemberBlocked" checked="@(item2==null?false:item2.memberBlocked)">
                                                                Üye Bloklama
                                                            </label>
                                                            <label class="checkbox-inline">
                                                                <input type="checkbox" id="cbMemberProcess" checked="@(item2==null?false:item2.memberProcess)">
                                                                Üye İşlemleri
                                                            </label>
                                                            <label class="checkbox-inline">
                                                                <input type="checkbox" id="cbEditAdmin" checked="@(item2==null?false:item2.editAdmin)">
                                                                Admin Düzenleme
                                                            </label>
                                                            <button type="button"  onclick="Save(@item.id);"  class="btn btn-primary" >Kaydet</button>

                                                        }

                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                
                                }
                            }

                        </tbody>
                    </table>
                </div>
                <!-- /.table-responsive -->
            </div>
            <!-- /.panel-body -->
        </div>
    </div>
    <!-- /.col-lg-12 -->
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script src="~/Content/js/notify.js"></script>

<script src="~/Content/js/notify.min.js"></script>
<script type="text/javascript">

    //function Yetki(adminId) {
    //    $("#cbMemberProcess").is(":checked");
    //    $("#cbMemberBlocked").is(":checked");
    //    $("#cbEditAdmin").is(":checked");
    //}
    function Save(Id) {
        var yetki = {
            id: 0,
            adminId: Id,
            memberProcess: $("#cbMemberProcess").is(":checked"),
            memberBlocked: $("#cbMemberBlocked").is(":checked"),
            editAdmin: $("#cbEditAdmin").is(":checked")
        }
        $.getJSON("/Admin/AddYetki", yetki, function (data) {

            $suc = false;

            $.each(data, function (key, val) {
                if (key == "success") {
                    $suc = val;
                }
                else if (key == "message" && $suc == false) {
                    $.notify(val, "warn");

                }
                else {
                    $.notify("Yetkiler Verildi", "success");
                }
            });
        });

    }
    function Admin_Add() {
        var admin = {
            id: 0,
            adi: $("#txtadi").val(),
            soyadi: $("#txtsoyadi").val(),
            mail: $("#txtmail").val(),
            sifre: $("#txtsifre").val(),
            adres: $("#txtadres").val(),
            tel: $("#txttel").val(),
            Tc: $("#txtTc").val()

        }
        $.getJSON("/Admin/Admin_Add", admin, function (data) {

            $suc = false;

            $.each(data, function (key, val) {
                if (key == "success") {
                    $suc = val;
                }
                else if (key == "message" && $suc == false) {
                    $.notify(val, "warn");

                }
                else {
                    $.notify("Admin Kayıt Edildi..", "success");
                }
            });
        });

    }
</script>
