@{
    ViewBag.Title = "Ozellik";
    Layout = "~/Views/Admin/Index.cshtml";
}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">
    function Ozellik_Add() {
        var vals = "";
        var sel = document.querySelector("#lstCategories");
        for (var i = 0, n = sel.options.length; i < n; i++) { 
            if (sel.options[i].value) {
                vals+=sel.options[i].value+",";
            }
        }
        try{
            
            var obj = {
                id: 0,
                name: $("#txtozellik").val(),
                catIds:vals
            }
            $.getJSON("/Admin/Ozellik_Add", obj, function (data) {
                $suc = false;

                $.each(data, function (key, val) {
                    if (key == "success") {
                        $suc = val;
                    }
                    else if (key == "message" && $suc == false) {
                        $.notify(val, "warn");
                    }
                    else {
                        $.notify("Özellik Kayıt Edildi..", "success");
                    }
                });
            });
        }
        catch (ex) {
            alert(ex);
        }
    }
    function Add() {
        var CatID = $("#dtlParent").val();
        var Cat = $("#dtlParent option:selected").text();
        var list = $("#lstCategories");
        var options = $("#lstCategories option[value="+CatID+"]");
        if (options.length > 0) {
            //alert("Bu kategoriyi eklediniz !! ");
            $.notify("Bu kategoriyi eklediniz !! ", "warn");
            return;
        }
        var html = list.html();
        html += "<option value=" + CatID + ">" + Cat + "</option>";
        list.html(html);

    }
    function Del() {
        //if (x == null)
        //{
        //    $.notify("Listeden kaldırmak istediğiniz kategoriyi seçiniz !!", "warn");
        //}
        var x = document.getElementById("lstCategories");
            x.remove(x.selectedIndex);
    }
</script>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
        </div>

    </div>
  <div class="notifyjs-corner" style="top: 100px; right: 0px;">
        <div class="notifyjs-wrapper notifyjs-hidable">
            <div class="notifyjs-arrow" style=""></div>
            <div class="notifyjs-container">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-4">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Ürün Özellikleri
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label>Özellik</label>
                        <input type="text" class="form-control" id="txtozellik" name="txtozellik">
                        <label>Kategori Seçiniz</label>
                        <table>
                            <tr>
                                <td>
                                    <div align="Left">
                                        <select class="form-control" id="dtlParent" name="dtlParent">
                                            @using (var context = new MvcProjem.Models.VeriTabanı())
                                            {
                                                var query = from a in context.kategoriler select a;
                                                foreach (var item in query)
                                                {
                                                <option value="@item.id">@item.kategoriadi</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    <div align="Right">
                                        <button type="button" class="btn btn-primary fa fa-plus" onclick="return Add();"></button>
                                         <button type="button" class="btn btn-primary fa fa-minus" onclick="return Del();"></button>
                                    </div>
                                </td>
                            </tr>
                        </table>
                        <div class="form-group" data-live-search="true">
                            <label></label>
                            <select multiple class="form-control" id="lstCategories">
                              
                            </select>
                        </div>
                    </div>
                    <button type="button" onclick="Ozellik_Add();" class="btn btn-primary">Özellik Ekle</button>
                </div>
            </div>

        </div>
        <div class="col-lg-8">
             <div class="panel panel-default">
                    <div class="panel-heading">
                        Özellik Listesi
                       
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Adı</th>
                                        <th>Kategori Adı</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @using (var context = new MvcProjem.Models.VeriTabanı())
                                    {
                                        //var query1 = from a in context.ozellikler select a;
                                        var query= from  a in context.ozellikler join b in context.k_ozellik on a.id equals b.ozellikid join k in context.kategoriler on b.kategoriid equals k.id orderby a.id ascending select new {a.id ,a.name ,k.kategoriadi};  
                                        foreach (var item in query)
                                        {
                                        <tr>
                                            <td>@item.id</td>
                                            <td>@item.name</td>
                                            <td>@item.kategoriadi</td>
                                        </tr>
                                        }

                                    }
                                </tbody>
                            </table>
                        </div>
                        <!-- /.table-responsive -->
                    </div>
                    <!-- /.panel-body -->
                </div>
        </div>

    </div>

</div>
<script src="~/Content/js/notify.js"></script>
<script src="~/Content/js/notify.min.js"></script>